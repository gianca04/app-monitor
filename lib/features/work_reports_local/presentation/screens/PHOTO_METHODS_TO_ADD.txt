// ADD THESE METHODS TO work_report_local_form_screen.dart
// Insert after the _delete() method, before the build() method

  // ==================== PHOTO MANAGEMENT ====================
  Future<void> _pickImage() async {
    final picker = ImagePicker();
    final pickedFile = await picker.pickImage(source: ImageSource.gallery);

    if (pickedFile != null) {
      final appDir = await getApplicationDocumentsDirectory();
      final fileName = 'photo_${DateTime.now().millisecondsSinceEpoch}.jpg';
      final savedImage = await File(pickedFile.path).copy('${appDir.path}/$fileName');

      setState(() {
        _photos.add({
          'photoPath': savedImage.path,
          'descripcion': '',
        });
      });
    }
  }

  void _removePhoto(int index) {
    setState(() {
      _photos.removeAt(index);
    });
  }

  Future<void> _savePhotos(int workReportId) async {
    final createPhotoUseCase = ref.read(createWorkReportPhotoLocalUseCaseProvider);

    for (var photo in _photos) {
      if (photo['id'] == null) {  // Only save new photos
        final entity = WorkReportPhotoLocalEntity(
          workReportId: workReportId,
          photoPath: photo['photoPath'],
          beforeWorkPhotoPath: null,
          descripcion: photo['descripcion'],
          beforeWorkDescripcion: null,
          createdAt: DateTime.now().toIso8601String(),
          updatedAt: DateTime.now().toIso8601String(),
        );
        await createPhotoUseCase(entity);
      }
    }
  }

  Future<void> _loadPhotos() async {
    if (widget.reportId == null) return;

    final getPhotosUseCase = ref.read(getPhotosByWorkReportLocalUseCaseProvider);
    final result = await getPhotosUseCase(widget.reportId!);

    result.fold(
      (failure) => null,
      (photos) {
        if (mounted) {
          setState(() {
            _photos.clear();
            for (var photo in photos) {
              _photos.add({
                'id': photo.id,
                'photoPath': photo.photoPath,
                'descripcion': photo.descripcion ?? '',
              });
            }
          });
        }
      },
    );
  }
